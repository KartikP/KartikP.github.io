

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Tutorial: Reverberating Super Burst Detection Workflow - KARTIK PRADEEPAN</title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="KARTIK PRADEEPAN">
<meta property="og:title" content="Tutorial: Reverberating Super Burst Detection Workflow">


  <link rel="canonical" href="http://localhost:4000/portfolio/RSB_Detection_workflow/">
  <meta property="og:url" content="http://localhost:4000/portfolio/RSB_Detection_workflow/">



  <meta property="og:description" content="A breakdown of how RSB detection and analysis works.">





  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2023-09-21T00:00:00-07:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "KARTIK PRADEEPAN",
      "url" : "http://localhost:4000",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="KARTIK PRADEEPAN Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    

<!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="http://localhost:4000/images/apple-touch-icon-57x57.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="60x60" href="http://localhost:4000/images/apple-touch-icon-60x60.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="76x76" href="http://localhost:4000/images/apple-touch-icon-76x76.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="120x120" href="http://localhost:4000/images/apple-touch-icon-120x120.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="152x152" href="http://localhost:4000/images/apple-touch-icon-152x152.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/images/apple-touch-icon-180x180.png?v=M44lzPylqQ">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="http://localhost:4000/images/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="http://localhost:4000/images/manifest.json?v=M44lzPylqQ">
<link rel="mask-icon" href="http://localhost:4000/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000">
<link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ">
<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="http://localhost:4000/images/mstile-144x144.png?v=M44lzPylqQ">
<meta name="msapplication-config" content="http://localhost:4000/images/browserconfig.xml?v=M44lzPylqQ">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="http://localhost:4000/assets/css/academicons.css"/>

<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>

<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/">KARTIK PRADEEPAN</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/files/Kartik_Pradeepan_Resume.pdf">Resume</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/publications/">Publications</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/projects/">Projects</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/posts/">Posts</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/cv/">CV</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://localhost:4000/images/ani_dp.png" class="author__avatar" alt="Kartik Pradeepan">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Kartik Pradeepan</h3>
    <p class="author__bio">Computational Neuroscience & Data Science</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><a href="https://www.youtube.com/watch?v=wupToqz1e2g"><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> The Pale Blue Dot</a></li>
      
      
      
      
        <li><a href="mailto:kartikspradeepan@gmail.com"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i> Email</a></li>
      
      
       
      
        <li><a href="https://twitter.com/KartikPradeepan"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
        <li><a href="https://www.linkedin.com/in/kartikpradeepan"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
      
      
      
      
      
      
        <li><a href="https://github.com/KartikP"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        <li><a href="https://scholar.google.ca/citations?user=qP7VnZ8AAAAJ&hl=en"><i class="fas fa-fw fa-graduation-cap"></i> Google Scholar</a></li>
      
      
      
        <li><a href="https://orcid.org/0000-0003-0979-7928"><i class="ai ai-orcid-square ai-fw"></i> ORCID</a></li>
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Tutorial: Reverberating Super Burst Detection Workflow">
    <meta itemprop="description" content="A breakdown of how RSB detection and analysis works.">
    <meta itemprop="datePublished" content="September 21, 2023">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Tutorial: Reverberating Super Burst Detection Workflow
</h1>
          
        
        
        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2023-09-21T00:00:00-07:00">September 21, 2023</time></p>
        
        
             
        
    
        </header>
      

      <section class="page__content" itemprop="text">
        <p><em>Still a work in progress. This tutorial will be update in chunks. Analysis is quite long and Iâ€™m only 1/5 done.</em></p>

<h2 id="install-necessary-packages">Install necessary packages</h2>

<h2 id="import-libraries">Import libraries</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">convolve</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">find_peaks</span>

<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filename</span> <span class="o">=</span> <span class="s">"/content/drive/MyDrive/Colab Notebooks/spike_data.csv"</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">12500</span>
</code></pre></div></div>

<h2 id="convert-axion-biosystems-spike_listcsv-file-into-a-dataframe">Convert Axion Biosystemâ€™s spike_list.csv file into a dataframe</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">organize_spikelist</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="c1"># Create neuralMetric dataframe
</span>    <span class="n">spikelist_file</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">spikelist_file</span> <span class="o">=</span> <span class="n">spikelist_file</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">spikelist_file</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">spikelist_file</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">spikelist_file</span> <span class="o">=</span> <span class="n">spikelist_file</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">spiketimes</span> <span class="o">=</span> <span class="n">spikelist_file</span><span class="p">[[</span><span class="s">"Time (s)"</span><span class="p">,</span> <span class="s">"Electrode"</span><span class="p">]]</span>
    <span class="n">spiketimes</span> <span class="o">=</span> <span class="n">spiketimes</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">spiketimes</span> <span class="o">=</span> <span class="n">spiketimes</span><span class="p">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">spiketimes</span> <span class="o">=</span> <span class="n">spiketimes</span><span class="p">[</span><span class="n">spiketimes</span><span class="p">[</span><span class="s">"Electrode"</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">"_"</span><span class="p">)]</span>
    <span class="n">spiketimes</span> <span class="o">=</span> <span class="n">spiketimes</span><span class="p">.</span><span class="n">astype</span><span class="p">({</span><span class="s">"Time (s)"</span><span class="p">:</span> <span class="nb">float</span><span class="p">})</span>
    <span class="n">spiketimes</span><span class="p">[</span><span class="s">"Well"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">electrode</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"_"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">[</span><span class="s">"Electrode"</span><span class="p">].</span><span class="n">values</span><span class="p">)]</span>
    <span class="n">spiketimes</span><span class="p">[</span><span class="s">"Channel"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">electrode</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"_"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">[</span><span class="s">"Electrode"</span><span class="p">].</span><span class="n">values</span><span class="p">)]</span>

    <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">spikelist_file</span> <span class="o">==</span> <span class="s">"Well Information"</span><span class="p">)</span>
    <span class="n">metadata_slice</span> <span class="o">=</span> <span class="n">spikelist_file</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]:].</span><span class="n">transpose</span><span class="p">().</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">metadata_slice</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">metadata_slice</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">metadata_slice</span> <span class="o">=</span> <span class="n">metadata_slice</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">well</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata_slice</span><span class="p">[</span><span class="s">"Well"</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">well</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">well</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata_slice</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">"Treatment"</span><span class="p">]</span>
            <span class="n">label</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">well</span><span class="p">)</span><span class="o">+</span><span class="s">"-"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">metadata_slice</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">"Treatment"</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">spiketimes</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">label</span>

<span class="n">spiketimes</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">organize_spikelist</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;ipython-input-4-4aef381c3626&gt;:3: ParserWarning: Falling back to the 'python' engine because the 'c' engine does not support regex separators (separators &gt; 1 char and different from '\s+' are interpreted as regex); you can avoid this warning by specifying engine='python'.
  spikelist_file = pd.read_csv(filepath, sep='\r\n', header=None)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spiketimes</span><span class="p">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div id="df-a25a432f-46e4-46a0-819c-bc2bea4e0195" class="colab-df-container">
    <div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time (s)</th>
      <th>Electrode</th>
      <th>Well</th>
      <th>Channel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.00184</td>
      <td>A1_76</td>
      <td>A1</td>
      <td>76</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.00824</td>
      <td>C1_51</td>
      <td>C1</td>
      <td>51</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.01160</td>
      <td>B1_47</td>
      <td>B1</td>
      <td>47</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.01984</td>
      <td>A1_42</td>
      <td>A1</td>
      <td>42</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.02224</td>
      <td>C1_41</td>
      <td>C1</td>
      <td>41</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-a25a432f-46e4-46a0-819c-bc2bea4e0195')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z" />
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-a25a432f-46e4-46a0-819c-bc2bea4e0195 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-a25a432f-46e4-46a0-819c-bc2bea4e0195');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-4e3a6e10-7901-42d9-a864-ccb3a4720420">
  <button class="colab-df-quickchart" onclick="quickchart('df-4e3a6e10-7901-42d9-a864-ccb3a4720420')" title="Suggest charts." style="display:none;">

&lt;svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
     width="24px"&gt;
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
    </g>
&lt;/svg&gt;
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-4e3a6e10-7901-42d9-a864-ccb3a4720420 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>
    </div>
  </div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spiketimes</span><span class="p">[</span><span class="s">"Well"</span><span class="p">].</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array(['A1', 'C1', 'B1', 'A4', 'C2', 'B2', 'B4', 'A2', 'C3', 'C4', 'B3',
       'A3'], dtype=object)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">spiketimes</span><span class="p">[</span><span class="s">"Channel"</span><span class="p">].</span><span class="n">unique</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>array(['76', '51', '47', '42', '41', '16', '26', '13', '18', '31', '84',
       '44', '82', '38', '85', '32', '88', '78', '11', '72', '87', '75',
       '48', '62', '24', '65', '63', '25', '15', '43', '81', '61', '46',
       '58', '83', '55', '57', '52', '12', '73', '22', '56', '67', '77',
       '66', '53', '36', '74', '86', '45', '23', '33', '21', '14', '71',
       '17', '37', '35', '28', '54', '27', '34', '68', '64'], dtype=object)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">duration</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">[</span><span class="s">"Time (s)"</span><span class="p">])</span><span class="o">/</span><span class="mf">100.0</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"It appears the duration of these recordings was </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s"> seconds."</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It appears the duration of these recordings was 300 seconds.
</code></pre></div></div>

<p>The data that weâ€™ll be dealing with are spike times from a 12-well multielectrode array system. Each well contains 64 channels (arranged in an 8x8 grid). Channels are labeled according to a cartesian coordinate system where the first digit represents x (or the row) and the second digit represents y (or the column).</p>

<h2 id="select-a-well-to-analyze">Select a well to analyze</h2>
<p>This is where you would start wrapping the below code into a loop that iterates through each well, each plate/recording.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">well_id</span> <span class="o">=</span> <span class="s">"A3"</span>
</code></pre></div></div>

<h2 id="quick-look-at-the-network-activity">Quick look at the network activity</h2>
<p>Here we are plotting a histogram of spike times from the well we selected, using a bin size of 0.1 seconds (300 second duration/3000 bins).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">[</span><span class="n">spiketimes</span><span class="p">[</span><span class="s">"Well"</span><span class="p">]</span><span class="o">==</span><span class="n">well_id</span><span class="p">][</span><span class="s">"Time (s)"</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">3000</span><span class="p">);</span>
<span class="n">sns</span><span class="p">.</span><span class="n">despine</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Time (s)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Total number of spikes in network (Bin size:1s)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Sort of like a PSTH - representing network activity"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Text(0.5, 1.0, 'Sort of like a PSTH - representing network activity')
</code></pre></div></div>

<p><img src="../RSB_Detection_workflow_files/RSB_Detection_workflow_14_1.png" alt="png" /></p>

<p>It looks like there is some interesting network bursting activity! Are these reverberating super bursts (RSB) like the ones mentioned in Pradeepan et al., 2023? ðŸ˜‚</p>

<p>Jokes aside, the code below will help identify whether this is or isnâ€™t an RSB. But for now, weâ€™ll plot a close up of a smaller window.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Definitely do not keep plotting histograms with large bin sizes if you want your code to run fast
</span><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">hist</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">[</span><span class="n">spiketimes</span><span class="p">[</span><span class="s">"Well"</span><span class="p">]</span><span class="o">==</span><span class="n">well_id</span><span class="p">][</span><span class="s">"Time (s)"</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">3000</span><span class="p">);</span>
<span class="n">sns</span><span class="p">.</span><span class="n">despine</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">146</span><span class="p">,</span> <span class="mi">157</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Time (s)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Total number of spikes in network (Bin size:1s)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Multiple peaks within a network event"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Text(0.5, 1.0, 'Multiple peaks within a network event')
</code></pre></div></div>

<p><img src="../RSB_Detection_workflow_files/RSB_Detection_workflow_16_1.png" alt="png" /></p>

<h2 id="sort-data-frame-containing-mixed-bag-of-electrode-and-spike-times-based-on-channel-name">Sort data frame containing mixed-bag of electrode and spike times based on channel name</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">channel_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">9</span><span class="p">)]</span>
<span class="s">'''
The above produces the following:
  [11, 12, 13, 14, 15, 16, 17, 18,
  21, 22, 23, 24, 25, 26, 27, 28,
  31, 32, 33, 34, 35, 36, 37, 38,
  41, 42, 43, 44, 45, 46, 47, 48,
  51, 52, 53, 54, 55, 56, 57, 58,
  61, 62, 63, 64, 65, 66, 67, 68,
  71, 72, 73, 74, 75, 76, 77, 78,
  81, 82, 83, 84, 85, 86, 87, 88]
'''</span>

<span class="k">def</span> <span class="nf">generate_raster</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">,</span> <span class="n">well_id</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">channel_ids</span><span class="p">):</span>
  <span class="s">'''
  well_data: Data frame in the format seen above
  duration: Length of recording in seconds (in this case 300 seconds)
  channel_ids: Name of all channels in the format seen in the data frame "channel" column
  '''</span>
  <span class="n">raster</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="c1"># Loop through each channel regardless of activity
</span>  <span class="n">well_spiketimes</span> <span class="o">=</span> <span class="n">spiketimes</span><span class="p">[</span><span class="n">spiketimes</span><span class="p">[</span><span class="s">"Well"</span><span class="p">]</span> <span class="o">==</span> <span class="n">well_id</span><span class="p">].</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channel_ids</span><span class="p">:</span>
    <span class="c1"># If the channel is found in my data (i.e., it had at least 1 spike)
</span>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span> <span class="ow">in</span> <span class="n">well_spiketimes</span><span class="p">[</span><span class="s">"Channel"</span><span class="p">].</span><span class="n">to_list</span><span class="p">():</span>
      <span class="c1"># Find spike times associated with that channel
</span>      <span class="n">spiketrain</span> <span class="o">=</span> <span class="n">well_spiketimes</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">well_spiketimes</span><span class="p">[</span><span class="s">"Channel"</span><span class="p">]</span><span class="o">==</span><span class="nb">str</span><span class="p">(</span><span class="n">channel</span><span class="p">),</span> <span class="n">well_spiketimes</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">"Time"</span><span class="p">)].</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="c1"># Convert spike times that occur before the end of the recording (i.e., duration) to an array
</span>      <span class="n">spiketrain</span> <span class="o">=</span> <span class="n">spiketrain</span><span class="p">.</span><span class="n">to_numpy</span><span class="p">().</span><span class="n">flatten</span><span class="p">()[</span><span class="n">spiketrain</span><span class="p">.</span><span class="n">to_numpy</span><span class="p">().</span><span class="n">flatten</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">duration</span><span class="p">]</span>
      <span class="c1"># Store array
</span>      <span class="n">raster</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">spiketrain</span><span class="p">)</span>
    <span class="c1"># If the channel is not found in my data, I still want to store that it was empty
</span>    <span class="k">else</span><span class="p">:</span>
      <span class="n">raster</span><span class="p">.</span><span class="n">append</span><span class="p">([])</span>
  <span class="k">return</span> <span class="n">raster</span>

<span class="n">raster</span> <span class="o">=</span> <span class="n">generate_raster</span><span class="p">(</span><span class="n">spiketimes</span><span class="p">,</span> <span class="n">well_id</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">channel_ids</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="visualize-network-activity-as-a-raster-plot">Visualize network activity (as a raster plot)</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">.</span><span class="n">update</span><span class="p">({</span><span class="s">'font.size'</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rc</span><span class="p">(</span><span class="s">'axes'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">eventplot</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">linelengths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Channels"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Time (s)"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Text(0.5, 0, 'Time (s)')
</code></pre></div></div>

<p><img src="../RSB_Detection_workflow_files/RSB_Detection_workflow_20_1.png" alt="png" /></p>

<p>We did it with the histogram, might as well do it with the raster. ðŸ¤·</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">.</span><span class="n">update</span><span class="p">({</span><span class="s">'font.size'</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rc</span><span class="p">(</span><span class="s">'axes'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">eventplot</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">linelengths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">146</span><span class="p">,</span> <span class="mi">157</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Channels"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Time (s)"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Text(0.5, 0, 'Time (s)')
</code></pre></div></div>

<p><img src="../RSB_Detection_workflow_files/RSB_Detection_workflow_22_1.png" alt="png" /></p>

<h2 id="approach-1-generate-spike-density-function">Approach 1: Generate spike density function</h2>

<h3 id="gaussian-kernel">Gaussian Kernel</h3>
<p>Note: You should be using a bandwidth optimized kernel. Refer to Shimazaki &amp; Shinomoto, 2010)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate_gaussian_kernel</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">12500</span><span class="p">):</span>
    <span class="s">'''
    :param sigma: Width of kernel
    :param fs: Sampling frequency in Hz
    :return: Gaussian kernel
    '''</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">norm</span><span class="p">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kernel</span>
</code></pre></div></div>

<h3 id="binary-spike-matrix">Binary spike matrix</h3>
<p>Create a matrix of nChannels x Y time points, where Y is the duration * sampling frequency.
Each cell will contain either a 0 or 1 depending on whether a spike was found i.e., 1 or not i.e., 0.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate_spikematrix</span><span class="p">(</span><span class="n">spiketrain</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">12500</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
    <span class="s">'''
    :param spiketrain: Takes spikes times from a single channel
    :param fs: Sampling frequency in Hz
    :param duration: Duration of recording in seconds
    :return: spikematrix: Binary matrix containing spikes
    '''</span>
    <span class="n">spiketimes</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">spiketrain</span><span class="p">)</span>
    <span class="n">spiketimes</span> <span class="o">=</span> <span class="n">spiketimes</span><span class="p">[</span><span class="n">spiketimes</span> <span class="o">&lt;=</span> <span class="n">duration</span><span class="p">]</span>  <span class="c1"># Ensure recording is desired length
</span>    <span class="n">spikematrix</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)</span>  <span class="c1"># Generate empty spike matrix with appropriate number of bins
</span>    <span class="k">for</span> <span class="n">spike</span> <span class="ow">in</span> <span class="n">spiketimes</span><span class="p">:</span>
        <span class="n">spikematrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">spike</span> <span class="o">*</span> <span class="n">fs</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">spikematrix</span>
</code></pre></div></div>

<h3 id="convolve-gaussian-kernel-and-spike-matrix">Convolve gaussian kernel and spike matrix</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate_sdf</span><span class="p">(</span><span class="n">spikematrix</span><span class="p">,</span> <span class="n">gaussian_kernel</span><span class="p">):</span>
    <span class="s">'''
    :param spikematrix: Binary matrix containing spikes
    :param gaussian_kernel: Gaussian kernel to be convolved with spikematrix
    :return: sdf: Continuous timeseries representing probability distribution of activity
    '''</span>
    <span class="n">sdf_tmp</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">spikematrix</span><span class="p">,</span> <span class="n">gaussian_kernel</span><span class="p">)</span>
    <span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf_tmp</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sdf_tmp</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">spikematrix</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sdf_tmp</span><span class="p">)</span><span class="o">-</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">sdf_tmp</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">spikematrix</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">))]</span>
    <span class="n">sdf</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">gaussian_kernel</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sdf</span>
</code></pre></div></div>

<h3 id="iterate-through-each-channel-and-generate-the-channels-sdf">Iterate through each channel, and generate the channelâ€™s SDF</h3>
<p>Convolution takes some time because the spike matrix is quite large. There is a way to avoid spike density function generation by relying solely on histograms (like you saw above) but the timing of network event boundaries will be less precise.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kernel</span> <span class="o">=</span> <span class="n">generate_gaussian_kernel</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.075</span><span class="p">)</span>

<span class="n">maxFR</span><span class="p">,</span> <span class="n">channel_sdf</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">channel_ids</span><span class="p">):</span>
  <span class="n">spiketrain</span> <span class="o">=</span> <span class="n">raster</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
  <span class="n">channel_spikematrix</span> <span class="o">=</span> <span class="n">generate_spikematrix</span><span class="p">(</span><span class="n">spiketrain</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">12500</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
  <span class="n">sdf_tmp</span> <span class="o">=</span> <span class="n">generate_sdf</span><span class="p">(</span><span class="n">channel_spikematrix</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>
  <span class="n">channel_sdf</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">sdf_tmp</span><span class="p">)</span>
  <span class="n">maxFR</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sdf_tmp</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">network_sdf</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">channel_sdf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">weighted_network_sdf</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">average</span><span class="p">(</span><span class="n">channel_sdf</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">maxFR</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">duration</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">12500</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">network_sdf</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">weighted_network_sdf</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">146</span><span class="p">,</span> <span class="mi">157</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Channels/Firing Rate (Hz)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Time (s)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">([</span><span class="s">"Network SDF"</span><span class="p">,</span> <span class="s">"Weighted Network SDF"</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;matplotlib.legend.Legend at 0x7aaa5bd15930&gt;
</code></pre></div></div>

<p><img src="../RSB_Detection_workflow_files/RSB_Detection_workflow_34_1.png" alt="png" /></p>

<p>As you can see, the general shape of the spike density function (which is an estimate of the networkâ€™s instantaneous firing rate) is the same between the non-maxFR-weighted SDF and the maxFR-weighted SDF. You can use whichever one, but I prefer to use the maxFR-weighted SDF because it helps improve signal:noise for subsequent analysis.</p>

<h2 id="visualize-raster-plot-and-spike-density-function">Visualize raster plot and spike density function</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">.</span><span class="n">update</span><span class="p">({</span><span class="s">'font.size'</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rc</span><span class="p">(</span><span class="s">'axes'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">eventplot</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">linelengths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">);</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">duration</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">12500</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">weighted_network_sdf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">146</span><span class="p">,</span> <span class="mi">157</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Channels/Firing Rate (Hz)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Time (s)"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Text(0.5, 0, 'Time (s)')
</code></pre></div></div>

<p><img src="../RSB_Detection_workflow_files/RSB_Detection_workflow_37_1.png" alt="png" /></p>

<p>As you can see, generally the spike density function does a really good job of representing the average activity across the network. You may notice that the â€œramp-upâ€ prior to each network burst starts before activity has truly started. This is largely an artifact of the gaussian kernel. To avoid this, you can use an alpha function or any function that you feel represents the probability of an action potential the best. For this example, and generally most purposes, a gaussian kernel will suffice.</p>

<h1 id="reverberating-network-detection">Reverberating Network Detection</h1>

<h2 id="did-this-network-have-a-sufficiently-high-firing-rate-to-warrant-further-analysis">Did this network have a sufficiently high firing rate to warrant further analysis?</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">isBursting</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">BURST_THRESHOLD</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">weighted_network_sdf</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">BURST_THRESHOLD</span><span class="p">:</span>
  <span class="n">isBursting</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Is Network Bursting? </span><span class="si">{</span><span class="n">isBursting</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Is Network Bursting? True
</code></pre></div></div>

<h2 id="peak-detection">Peak detection</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">detect_burst_peaks</span><span class="p">(</span><span class="n">sdf</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">12500</span><span class="p">):</span>
    <span class="s">'''
    :param sdf: Spike density function
    :param fr: Minimum average firing rate (amplitude in SDF) required to be considered a burst
    :return: Burst peak times
    '''</span>
    <span class="n">burst_peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">find_peaks</span><span class="p">(</span><span class="n">sdf</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">delta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">burst_peaks</span><span class="o">/</span><span class="n">fs</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">burst_peak_times</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">if</span> <span class="n">isBursting</span><span class="p">:</span>
  <span class="n">burst_peak_times</span> <span class="o">=</span> <span class="n">detect_burst_peaks</span><span class="p">(</span><span class="n">weighted_network_sdf</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Detected </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">burst_peak_times</span><span class="p">)</span><span class="si">}</span><span class="s"> potential network bursts."</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Detected 145 potential network bursts.
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">.</span><span class="n">update</span><span class="p">({</span><span class="s">'font.size'</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rc</span><span class="p">(</span><span class="s">'axes'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">eventplot</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">linelengths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">);</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">duration</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">12500</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">weighted_network_sdf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">135</span><span class="p">,</span><span class="mi">165</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Channels/Firing Rate (Hz)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Time (s)"</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">burst_peak_times</span><span class="p">,</span> <span class="n">weighted_network_sdf</span><span class="p">[(</span><span class="n">burst_peak_times</span><span class="o">*</span><span class="n">fs</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="s">'v'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[&lt;matplotlib.lines.Line2D at 0x7aaa51140220&gt;]
</code></pre></div></div>

<p><img src="../RSB_Detection_workflow_files/RSB_Detection_workflow_45_1.png" alt="png" /></p>

<p>As you can see, our really basic peak detection was able to identify the location of all the network bursts in this recording. Depending on how noisy your activity is, you may need a more complicated approach.</p>

<h2 id="cluster-burst-peaks-along-inter-burst-peak-interval-and-firing-rate-dimensions">Cluster burst peaks along inter-burst-peak-interval and firing rate dimensions</h2>

<h3 id="visualize-data">Visualize data</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ibpi</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">diff</span><span class="p">(</span><span class="n">burst_peak_times</span><span class="p">)</span>
<span class="n">fr</span> <span class="o">=</span> <span class="n">weighted_network_sdf</span><span class="p">[(</span><span class="n">burst_peak_times</span><span class="o">*</span><span class="n">fs</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]</span>
<span class="n">sns</span><span class="p">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ibpi</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">fr</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">sns</span><span class="p">.</span><span class="n">despine</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Inter-burst-peak-interval (s)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Firing rate (Hz)"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Text(0, 0.5, 'Firing rate (Hz)')
</code></pre></div></div>

<p><img src="../RSB_Detection_workflow_files/RSB_Detection_workflow_49_1.png" alt="png" /></p>

<p>This approach ignores the first burst. We can deal with that later. But the important thing is that there appears to be two main clusters where expected.</p>

<h3 id="k-means-clustering">K-means clustering</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">k_means</span><span class="p">(</span><span class="n">ibpi</span><span class="p">,</span> <span class="n">fr</span><span class="p">):</span>
  <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">ibpi</span><span class="p">,</span> <span class="n">fr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
  <span class="c1">#scaler = StandardScaler()
</span>  <span class="c1">#scaled_features = scaler.fit_transform(features)
</span>
  <span class="n">kmeans_kwargs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">"init"</span><span class="p">:</span> <span class="s">"random"</span><span class="p">,</span>
      <span class="s">"n_init"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
      <span class="s">"max_iter"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
      <span class="s">"random_state"</span><span class="p">:</span> <span class="mi">0</span>
  <span class="p">}</span>
  <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">kmeans_kwargs</span><span class="p">)</span>
  <span class="n">kmeans</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">features</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">features</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

  <span class="c1"># Assign the mini-burst cluster as label 1
</span>  <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">cluster_x_1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cluster_x_2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cluster_y_1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cluster_y_2</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">cluster_x_1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cluster_x_2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cluster_y_1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cluster_y_2</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
  <span class="c1">#sns.scatterplot(x=cluster_x_1, y=cluster_y_1, color='green')
</span>  <span class="c1">#sns.scatterplot(x=cluster_x_2, y=cluster_y_2, color='red')
</span>
  <span class="c1"># Check what the percent of overlap is
</span>  <span class="n">num_of_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fr</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
  <span class="c1"># Overlapping x
</span>  <span class="n">rng_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cluster_x_1</span><span class="p">.</span><span class="nb">min</span><span class="p">(),</span> <span class="n">cluster_x_2</span><span class="p">.</span><span class="nb">min</span><span class="p">()),</span> <span class="nb">max</span><span class="p">(</span><span class="n">cluster_x_1</span><span class="p">.</span><span class="nb">max</span><span class="p">(),</span> <span class="n">cluster_x_2</span><span class="p">.</span><span class="nb">max</span><span class="p">())</span>
  <span class="n">n1_x</span><span class="p">,</span> <span class="n">bins1_x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">cluster_x_1</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">num_of_bins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">rng_x</span><span class="p">)</span>
  <span class="n">n2_x</span><span class="p">,</span> <span class="n">bins2_x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">cluster_x_2</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">num_of_bins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">rng_x</span><span class="p">)</span>
  <span class="n">intersection_x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">n1_x</span><span class="p">,</span><span class="n">n2_x</span><span class="p">)</span>

  <span class="n">overlapping_bins_x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">intersection_x</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">overlapping_bins_x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">overlapping_bursts_x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">n1_x</span><span class="p">[</span><span class="n">overlapping_bins_x</span><span class="p">]</span> <span class="o">+</span> <span class="n">n2_x</span><span class="p">[</span><span class="n">overlapping_bins_x</span><span class="p">])</span>
      <span class="n">percent_overlapping_x</span> <span class="o">=</span> <span class="n">overlapping_bursts_x</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="n">percent_overlapping_x</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="k">if</span> <span class="n">percent_overlapping_x</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"The well is probably not reverberating strongly if at all"</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">kmeans</span><span class="p">.</span><span class="n">labels_</span>


<span class="n">isReverb</span><span class="p">,</span> <span class="n">cluster_x</span><span class="p">,</span> <span class="n">cluster_y</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">k_means</span><span class="p">(</span><span class="n">ibpi</span><span class="p">,</span> <span class="n">fr</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">cluster_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">cluster_y</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Inter-burst-peak-interval (s)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Firing rate (Hz)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s">"Reverberation status: </span><span class="si">{</span><span class="n">isReverb</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="n">despine</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="../RSB_Detection_workflow_files/RSB_Detection_workflow_53_0.png" alt="png" /></p>


        
      </section>

      <footer class="page__meta">
        
        




      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/portfolio/RSB_Detection_workflow/" class="btn btn--twitter" title="Share on Twitter"><i class="fab fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/portfolio/RSB_Detection_workflow/" class="btn btn--facebook" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/portfolio/RSB_Detection_workflow/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fab fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="http://localhost:4000/portfolio/Spike%20Time%20Tiling%20Coefficient/" class="pagination--pager" title="Spiking Time Tiling Coefficient - Pairwise correlations between spike trains
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<a href="/sitemap/">Sitemap</a>
<!-- end custom footer snippets -->

        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="http://github.com/KartikP"><i class="fab fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 KARTIK PRADEEPAN. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-M1JHV55BQ5', 'auto');
  ga('send', 'pageview');
</script>






  </body>
</html>

